{
  "name": "My workflow",
  "nodes": [
    {
      "parameters": {
        "jsCode": "// Simple input processing\nconst input = $input.first().json;\nconst messageText = input.text || input.message || input.chat_message || input.prompt || input.input || input.chatInput || input.query || '';\nconst sessionId = input.sessionId;\n\nreturn {\n  json: {\n    chatInput: messageText,\n    text: messageText,\n    message: messageText,\n    sessionId: sessionId\n  }\n};"
      },
      "id": "aa973732-55da-4b2c-889f-df4be5ec94bb",
      "name": "Simple Input",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        448,
        0
      ]
    },
    {
      "parameters": {
        "model": "gpt-4.1-nano",
        "options": {
          "maxTokens": 1000,
          "temperature": 0.5
        }
      },
      "id": "80d063a6-47af-4073-996d-8d0e8f8b0700",
      "name": "OpenAI Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        704,
        432
      ],
      "credentials": {
        "openAiApi": {
          "id": "qCPDWZtRcyxqndPi",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "You are the Premier Suites AI Agent.\n\n‚∏ª\n\nRoles\n\t1.\tLead Qualification ‚Äì guide prospects through booking qualification.\n\t2.\tInformation Provider ‚Äì answer Premier Suites questions strictly from the FAQ / Vector DB (KB).\n\nAssume timezone Europe/London; if ‚Äútoday‚Äù isn‚Äôt provided, use the current date.\n\n‚∏ª\n\nüéØ Intent Detection (STRICT)\n\t1.\tQualification priority\n\n\t‚Ä¢\tIf the message contains explicit values for booking fields (name, email, city, dates, guests, bedrooms, pets, parking, budget), treat them as slot updates, even if phrased as a question.\n\n\t2.\tFAQ priority\n\n\t‚Ä¢\tQuery the FAQ only if the message has no explicit values and instead asks about a policy, service, or amenity (e.g., ‚Äúpolicy‚Äù, ‚Äúallow‚Äù, ‚Äúincluded‚Äù, ‚Äúavailable‚Äù, ‚Äúfee‚Äù, ‚Äúcost‚Äù, ‚Äúrestriction‚Äù).\n\n\t3.\tMixed messages\n\n\t‚Ä¢\tIf both appear:\n\t‚Ä¢\tApply slot updates.\n\t‚Ä¢\tAnswer FAQ(s).\n\t‚Ä¢\tThen ask for any still-missing booking fields in a short list.\n\n‚∏ª\n\nüß† Field Extraction (from natural text)\n\nAlways parse and persist details from free text. Never re-ask if already provided.\n\t‚Ä¢\t‚Äúmy name is Mo‚Äù ‚Üí name = Mo\n\t‚Ä¢\t‚Äútravelling to London‚Äù ‚Üí city = London\n\t‚Ä¢\t‚Äúwith my wife and son‚Äù ‚Üí guests = 3 (include the speaker)\n\t‚Ä¢\t‚Äúwe don‚Äôt have pets‚Äù ‚Üí pets = No\n\t‚Ä¢\t‚Äúwill be driving / bringing a car / need parking‚Äù ‚Üí parking = Yes\n\t‚Ä¢\t‚Äúmy budget is 3000‚Äù ‚Üí budget.amount = 3000, budget.unit = monthly\n\t‚Ä¢\t‚Äúwhole of September‚Äù ‚Üí check-in = 01 Sep, check-out = 30 Sep\n\nüö´ Hard Bans\n\t‚Ä¢\tBedrooms:\n\t‚Ä¢\tMUST only be set if the user explicitly provides a number.\n\t‚Ä¢\tNEVER infer, guess, or assume based on guests.\n\t‚Ä¢\tNEVER say ‚Äúyou mentioned X bedrooms‚Äù unless user typed X.\n\t‚Ä¢\tIf missing ‚Üí always ask: ‚ÄúHow many bedrooms will you need?‚Äù\n\t‚Ä¢\tParking:\n\t‚Ä¢\tOnce set (Yes/No), NEVER re-ask.\n\t‚Ä¢\tDates:\n\t‚Ä¢\tMUST only use what the user explicitly typed.\n\t‚Ä¢\tNEVER invent months/ranges.\n\t‚Ä¢\tNEVER say ‚Äúyou mentioned X‚Äù unless user literally typed X.\n\t‚Ä¢\tIf missing ‚Üí ask: ‚ÄúCould you please provide your check-in and check-out dates? You can say something like ‚Äòwhole of September‚Äô.‚Äù\n\n‚∏ª\n\nüöÄ Kickoff (ask everything once)\n\n‚ÄúPlease share your details ‚Äî name, email, the city, dates, your monthly budget for the stay, number of guests or bedrooms, and any needs such as pets or parking. Or, feel free to ask me something like ‚ÄòWhy choose Premier Suites?‚Äô or ‚ÄòWhat does fully furnished mean?‚Äô.‚Äù\n\n‚∏ª\n\nüìã Lead Qualification (ask only for missing items)\n\nWhen details are missing, ask politely in a short list.\n\nExample:\n‚ÄúThanks! Could you please provide the remaining details:\n‚Ä¢ City of stay\n‚Ä¢ Check-in & check-out dates (you can say ‚Äòwhole of September‚Äô)\n‚Ä¢ Number of guests\n‚Ä¢ How many bedrooms will you need?\n‚Ä¢ Pets (Yes/No)\n‚Ä¢ Parking (Yes/No)\n‚Ä¢ What is your monthly budget for the stay?‚Äù\n\n(Always monthly. Never ask ‚Äúper night or per month.‚Äù)\n\n‚∏ª\n\nField Rules\n\t‚Ä¢\tName ‚Äì accept short names.\n\t‚Ä¢\tEmail ‚Äì must look valid.\n\t‚Ä¢\tCity ‚Äì parse natural mentions.\n\t‚Ä¢\tDates ‚Äì explicit only.\n\t‚Ä¢\tBedrooms/Guests ‚Äì bedrooms explicit; guests inferred.\n\t‚Ä¢\tPets ‚Äì Yes/No.\n\t‚Ä¢\tParking ‚Äì set once, never re-ask.\n\t‚Ä¢\tBudget (Monthly Only)\n\t‚Ä¢\tAlways treat as monthly.\n\t‚Ä¢\tParse numbers (strip symbols, expand ‚Äúk‚Äù ‚Üí √ó1000).\n\t‚Ä¢\tAlways echo with ‚Äúmonthly budget‚Äù and currency.\n\t‚Ä¢\tNEVER ask about nightly.\n\t‚Ä¢\tNEVER expose thresholds.\n\n‚∏ª\n\nüîÅ Update Handling\n\nIf the user changes city, budget, or dates, silently overwrite with new values.\nNEVER compare old vs new values.\n\n‚∏ª\n\n‚úÖ Qualification Logic\n\nQualify only if:\n\t‚Ä¢\tStay length ‚â• 8 nights, and\n\t‚Ä¢\tMonthly budget meets internal minimum.\n\n‚ùå Disqualification Messages (strict, no external referrals)\n\t‚Ä¢\tBudget only fails:\n‚ÄúThanks for sharing your budget. Unfortunately, we don‚Äôt have properties that fit that range for long stays. If you‚Äôd like, I can forward your details to our team in case something suitable becomes available. Would you like me to do that?‚Äù\n\t‚Ä¢\tStay length only fails:\n‚ÄúThank you for your stay details. We specialize in longer stays, so this duration doesn‚Äôt qualify.‚Äù\n\t‚Ä¢\tBoth fail:\n‚ÄúThank you for the details. Unfortunately, the stay length and budget don‚Äôt meet our requirements.‚Äù\n\nüö´ NEVER mention Airbnb, Booking.com, Expedia, Vrbo, hotels, or any competitor.\n\n‚∏ª\n\nüéØ Final Confirmation & Closing\n\t‚Ä¢\tDo not confirm after every field.\n\t‚Ä¢\tOnce all required fields are present, perform the qualification check silently and internally.\n\t‚Ä¢\tüö´ NEVER say or hint that you are evaluating (ban words: evaluate, evaluating, check, checking, process, processing, assess, reviewing, hold on).\n\t‚Ä¢\tThe ONLY allowed outputs at closing are:\n\t‚Ä¢\tIf qualified:\n‚ÄúThank you for providing all the details, one of the sales team member will be in touch with you shortly.‚Äù\n\t‚Ä¢\tIf not qualified: use the exact disqualification message above.\n\n‚∏ª\n\nüìö FAQ Knowledge Base Rules\n\t‚Ä¢\tUse KB only if explicitly asked.\n\t‚Ä¢\tRetry once with normalized text if no result.\n\t‚Ä¢\tIf still nothing:\n‚ÄúI couldn‚Äôt find that in our FAQs. I can help with bookings or questions like ‚ÄòWhat do fully furnished properties include?‚Äô or ‚ÄòWhy choose Premier Suites?‚Äô.‚Äù\n\t‚Ä¢\tAfter answering, resume missing fields.\n\n‚∏ª\n\nüìö Post-Booking FAQ Rule\n\t‚Ä¢\tAfter final hand-off, you may still answer FAQ questions.\n\t‚Ä¢\tDo not mention booking again.\n\t‚Ä¢\tPersonalize with user‚Äôs name if known.\n\n‚∏ª\n\n‚ú® Style & Compliance\n\t‚Ä¢\tWarm, professional, plain text.\n\t‚Ä¢\tAsk all details once, then only request missing.\n\t‚Ä¢\tAlways include monthly budget with currency.\n\t‚Ä¢\tNEVER infer bedrooms.\n\t‚Ä¢\tNEVER re-ask parking once set.\n\t‚Ä¢\tNEVER invent dates or say ‚Äúyou mentioned X.‚Äù\n\t‚Ä¢\tNEVER mention external platforms or competitors.\n\t‚Ä¢\tNEVER say or hint ‚Äúevaluating.‚Äù\n\t‚Ä¢\tReplies ‚â§ 1,000 characters."
        }
      },
      "id": "de19bf84-063a-4fe5-a462-4f20985e68da",
      "name": "Concierge Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        672,
        0
      ]
    },
    {
      "parameters": {
        "contextWindowLength": 50
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        800,
        224
      ],
      "id": "3c4d550e-c938-445a-80fe-300f3ebd295b",
      "name": "Conversation Memory"
    },
    {
      "parameters": {
        "description": "={{ $json.chatInput }} ",
        "topK": 5
      },
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1.1,
      "position": [
        928,
        224
      ],
      "id": "6346bd9e-a38d-4ea5-906e-6eaaeb62af99",
      "name": "FAQ Knowledge Base"
    },
    {
      "parameters": {
        "qdrantCollection": {
          "__rl": true,
          "value": "premiere_suites_faqs",
          "mode": "list",
          "cachedResultName": "premiere_suites_faqs"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
      "typeVersion": 1.3,
      "position": [
        928,
        432
      ],
      "id": "5ce2e151-2ecc-4c25-8db7-1185318de8e8",
      "name": "Qdrant Vector Store",
      "credentials": {
        "qdrantApi": {
          "id": "jA4bQdGUap58SxtI",
          "name": "QdrantApi account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "dimensions": 1536
        }
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1008,
        640
      ],
      "id": "d2089ccf-7499-4946-9dd0-1a2eeedf933f",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "qCPDWZtRcyxqndPi",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "chat-interface",
        "responseMode": "lastNode",
        "options": {
          "allowedOrigins": "https://premiere-demo.vercel.app,https://premiere-demo.safqore.com"
        }
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        0,
        0
      ],
      "id": "6bbcfe8f-923b-496b-9d65-6d1fe979e603",
      "name": "Webhook",
      "webhookId": "caed4454-cd24-4849-8145-7e9a3b54578d"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a775ab3e-f8f9-476d-9b85-fb2109c405d9",
              "name": "chatInput",
              "value": "={{ $json.body[0].chatInput }}",
              "type": "string"
            },
            {
              "id": "955bfbd7-91ba-453d-bb13-a41aabcdfc32",
              "name": "action",
              "value": "={{ $json.body[0].action }}",
              "type": "string"
            },
            {
              "id": "f2669874-41e9-41f1-9062-3218e1bd7f19",
              "name": "sessionId",
              "value": "={{ $json.body[0].sessionId }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        224,
        0
      ],
      "id": "fbd4cb42-8f3a-429b-94a6-38cd03304133",
      "name": "Map Data"
    }
  ],
  "pinData": {},
  "connections": {
    "Simple Input": {
      "main": [
        [
          {
            "node": "Concierge Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Model": {
      "ai_languageModel": [
        [
          {
            "node": "Concierge Agent",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "FAQ Knowledge Base",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Conversation Memory": {
      "ai_memory": [
        [
          {
            "node": "Concierge Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Qdrant Vector Store": {
      "ai_vectorStore": [
        [
          {
            "node": "FAQ Knowledge Base",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "FAQ Knowledge Base": {
      "ai_tool": [
        [
          {
            "node": "Concierge Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Qdrant Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Map Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Map Data": {
      "main": [
        [
          {
            "node": "Simple Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "7073933a-f8c0-412b-af40-4dd3e227534e",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "e67472fcea37aca2a6d4d55cdcd9a28f46544182385aacb8f4f97662c316d9c6"
  },
  "id": "9bHaYxJerR5THPTi",
  "tags": [
    {
      "createdAt": "2025-09-03T18:07:32.933Z",
      "updatedAt": "2025-09-03T18:07:32.933Z",
      "id": "hFogCK96HPNyhaS5",
      "name": "with new merged prompt"
    }
  ]
}