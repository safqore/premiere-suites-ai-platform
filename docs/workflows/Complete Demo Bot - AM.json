{
  "name": "Premier Suites Concierge Agent",
  "nodes": [
    {
      "parameters": {
        "jsCode": "// Simple input processing\nconst input = $input.first().json;\nconst messageText = input.text || input.message || input.chat_message || input.prompt || input.input || input.chatInput || input.query || '';\nconst sessionId = input.sessionId;\n\nreturn {\n  json: {\n    chatInput: messageText,\n    text: messageText,\n    message: messageText,\n    sessionId: sessionId\n  }\n};"
      },
      "id": "eca69e44-52dc-4ef6-b1e2-b69de9080697",
      "name": "Simple Input",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -160,
        -208
      ]
    },
    {
      "parameters": {
        "options": {
          "maxTokens": 1000,
          "temperature": 0.5
        }
      },
      "id": "266e1c81-e052-438b-afec-fa141fea009f",
      "name": "OpenAI Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        92,
        224
      ],
      "credentials": {
        "openAiApi": {
          "id": "zbPim8HFLYuSwimv",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "You are the Premier Suites Booking Concierge AI Agent.\nYour role is to answer questions from the knowledge base and qualify leads for long stays.\n\nâ¸»\n\nğŸ¯ Roles\n\t1.\tLead Qualification: Guide potential customers through a qualification process.\n\t2.\tInformation Provider: Answer questions strictly from the FAQ / Vector DB (KB).\n\nâ¸»\n\nğŸ” Detect Intent\n\tâ€¢\tIf they say â€œI want to bookâ€, â€œI need accommodationâ€, â€œIâ€™m looking for a place to stayâ€ â†’ start/continue qualification.\n\tâ€¢\tIf they ask about Premier Suites (e.g., *â€œWhat is Premiere Suites Alliance?â€, â€œWhat locations do you have?â€, â€œWhatâ€™s your policyâ€¦â€) â†’ pause qualification, answer via KB, then resume the next unanswered qualification step.\n\tâ€¢\tIf they provide multiple details in one go â†’ extract all, confirm, and only ask for missing fields.\n\nâ¸»\n\nğŸ“ Lead Qualification Flow\n\nAsk ONE question at a time, in order â€” unless the user gives multiple answers in one go.\n\nFields to Collect:\n\t1.\tName\n\tâ€¢\tAccept short names (e.g., Mo, Li, Al, Jo) as valid.\n\tâ€¢\tOnly reject obvious gibberish (e.g., â€œasdf123â€).\n\t2.\tEmail\n\t3.\tCity of stay\n\t4.\tCheck-in and check-out dates\n\tâ€¢\tAccept DD/MM/YYYY, MM/DD/YYYY, or natural phrases like â€œwhole of Jan 2026â€.\n\tâ€¢\tMonth-only input â†’ pick a future year:\nâ€¢ If the month is still upcoming this year â†’ use this year.\nâ€¢ If the month has already passed this year â†’ use next year.\n\tâ€¢\tâ€œWhole of {month}â€ â†’ first to last day of that month.\n\tâ€¢\tâ€œFirst weekâ€, â€œlast 2 weeksâ€ â†’ expand into proper ranges.\n\tâ€¢\tAlways confirm full range + year:\nâ€œTo confirm, thatâ€™s DD/MM/YYYY to DD/MM/YYYY (N nights). Is that correct?â€\n\tâ€¢\tIf user says â€œthis is 2025â€ â†’ recompute both dates and reconfirm.\n\tâ€¢\tNever return past dates.\n\t5.\tNumber of bedrooms/guests\n\t6.\tPets (Yes/No)\n\t7.\tParking (Yes/No)\n\t8.\tBudget\n\tâ€¢\tDetect nightly vs monthly automatically.\n\tâ€¢\tValidate budget: must be â‰¥ 1500 monthly equivalent.\n\tâ€¢\tDo not disclose exact minimum thresholds to the user.\n\nâ¸»\n\nğŸ”€ Multi-field Input Handling\n\tâ€¢\tIf the user provides everything in one message, parse all fields.\n\tâ€¢\tConfirm back:\nâ€œGreat, I have you as {name}, email {email}, city {city}, staying {dates}, {bedrooms} bedroom(s), pets: {yes/no}, parking: {yes/no}, budget: {amount} {nightly/monthly}. Did I get that right?â€\n\tâ€¢\tOnly ask for missing or unclear fields.\n\tâ€¢\tAlways validate (budget, stay length, future dates).\n\nâ¸»\n\nğŸš« Disqualification Rules\n\tâ€¢\tIf budget < 1500 (monthly equivalent) â†’ politely apologize, suggest Airbnb/Booking.com, end chat.\n\tâ€¢\tIf stay â‰¤ 7 nights â†’ politely apologize, suggest Airbnb/Booking.com, end chat.\n\tâ€¢\tIf both are invalid, mention both reasons clearly.\n\tâ€¢\tNever disclose the exact cutoff number. Use phrasing like â€œUnfortunately, this doesnâ€™t meet our minimum requirements for a long stay.â€\n\nâ¸»\n\nğŸ“š Knowledge Base (FAQ / Vector DB)\n\tâ€¢\tFor any general question, ALWAYS call the â€œFAQ Knowledge Baseâ€ tool with the userâ€™s exact question.\n\tâ€¢\tIf no result, retry once with simplified/normalized version.\n\tâ€¢\tIf still nothing: reply â€œI couldnâ€™t find this in our FAQs.â€\n\tâ€¢\tNormalize â€œPremierâ€ vs â€œPremiereâ€ â†’ always treat as Premier Suites.\n\tâ€¢\tAfter answering a FAQ, resume qualification.\n\nâ¸»\n\nğŸ’¬ Style & Compliance\n\tâ€¢\tFriendly, diplomatic, professional.\n\tâ€¢\tPlain text only (no code blocks).\n\tâ€¢\tNever quote exact prices.\n\tâ€¢\tNever promise discounts.\n\tâ€¢\tAlways thank the user at the end:\nâ€œThank you for providing all the information, one of the sales team members will be in touch shortly.â€\n\nâ¸»\n\nâœ… With this setup:\n\tâ€¢\tShort names like Mo work fine.\n\tâ€¢\tYear inference is always future-safe (never past).\n\tâ€¢\tBudget validation is correct, no leaks.\n\tâ€¢\tMulti-field inputs are parsed at once if provided."
        }
      },
      "id": "d4104e34-ec42-457d-9ebf-0fe27be03683",
      "name": "Concierge Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        64,
        -208
      ]
    },
    {
      "parameters": {
        "contextWindowLength": 50
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        180,
        16
      ],
      "id": "82777a9e-a903-464f-8007-db899309876a",
      "name": "Conversation Memory"
    },
    {
      "parameters": {
        "description": "={{ $json.chatInput }} ",
        "topK": 5
      },
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1.1,
      "position": [
        308,
        16
      ],
      "id": "c34eadca-4f77-4016-82d0-2003f98b3be5",
      "name": "FAQ Knowledge Base"
    },
    {
      "parameters": {
        "qdrantCollection": {
          "__rl": true,
          "value": "premiere_suites_faqs",
          "mode": "list",
          "cachedResultName": "premiere_suites_faqs"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
      "typeVersion": 1.3,
      "position": [
        308,
        224
      ],
      "id": "2d5453d5-f9bc-402a-876d-fa7b218152dd",
      "name": "Qdrant Vector Store",
      "credentials": {
        "qdrantApi": {
          "id": "Rm21k4YKqNKkjc4C",
          "name": "QdrantApi account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "dimensions": 1536
        }
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        388,
        432
      ],
      "id": "b12f127d-f276-4a58-9f6a-58646023573b",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "zbPim8HFLYuSwimv",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "chat-interface",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -608,
        -208
      ],
      "id": "773555b6-3e4b-4c87-8c75-9740d96d1a28",
      "name": "Webhook",
      "webhookId": "caed4454-cd24-4849-8145-7e9a3b54578d"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a775ab3e-f8f9-476d-9b85-fb2109c405d9",
              "name": "chatInput",
              "value": "={{ $json.body[0].chatInput }}",
              "type": "string"
            },
            {
              "id": "955bfbd7-91ba-453d-bb13-a41aabcdfc32",
              "name": "action",
              "value": "={{ $json.body[0].action }}",
              "type": "string"
            },
            {
              "id": "f2669874-41e9-41f1-9062-3218e1bd7f19",
              "name": "sessionId",
              "value": "={{ $json.body[0].sessionId }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -384,
        -208
      ],
      "id": "4baa6864-6b95-47da-b3f3-ee53a21d2dbc",
      "name": "Map Data"
    }
  ],
  "pinData": {},
  "connections": {
    "Simple Input": {
      "main": [
        [
          {
            "node": "Concierge Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Model": {
      "ai_languageModel": [
        [
          {
            "node": "Concierge Agent",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "FAQ Knowledge Base",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Conversation Memory": {
      "ai_memory": [
        [
          {
            "node": "Concierge Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Qdrant Vector Store": {
      "ai_vectorStore": [
        [
          {
            "node": "FAQ Knowledge Base",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "FAQ Knowledge Base": {
      "ai_tool": [
        [
          {
            "node": "Concierge Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Qdrant Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Map Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Concierge Agent": {
      "main": [
        []
      ]
    },
    "Map Data": {
      "main": [
        [
          {
            "node": "Simple Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "a7f49c46-4b68-4e92-9734-b56de566ee88",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9f2a2f7a1ab90f16851d96be056bf107ed6605402b9f7d7d5d8768ec8bbda1f7"
  },
  "id": "B9whYAdbMATf4rs3",
  "tags": [
    {
      "createdAt": "2025-08-22T05:18:05.831Z",
      "updatedAt": "2025-08-22T05:18:05.831Z",
      "id": "eQ3OJiUEASt1P0d2",
      "name": "with new merged prompt"
    }
  ]
}